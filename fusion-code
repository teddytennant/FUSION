#!/usr/bin/env bash
# FUSION Code CLI launcher script (symlink-safe)
set -euo pipefail

# Resolve the real path of this script, following symlinks (BSD/macOS compatible)
SOURCE="${BASH_SOURCE[0]}"
while [ -L "$SOURCE" ]; do
  TARGET="$(readlink "$SOURCE")"
  if [[ "$TARGET" == /* ]]; then
    SOURCE="$TARGET"
  else
    DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"
    SOURCE="$DIR/$TARGET"
  fi
done
SCRIPT_DIR="$(cd -P "$(dirname "$SOURCE")" && pwd)"

# Check if code-cli is built
if [ ! -f "$SCRIPT_DIR/code-cli/dist/core/cli.js" ]; then
  echo "FUSION Code CLI not built. Building now..."
  cd "$SCRIPT_DIR/code-cli"
  npm install
  npm run build
  cd "$SCRIPT_DIR"
fi

exec node "$SCRIPT_DIR/code-cli/dist/core/cli.js" "$@" 